{"meta":{"title":"Arron's Lab","subtitle":null,"description":null,"author":"a dba's blog","url":"http://yoursite.com"},"pages":[{"title":"tags","date":"2017-08-12T12:36:45.000Z","updated":"2017-08-12T12:41:20.000Z","comments":true,"path":"tags/index.html","permalink":"http://yoursite.com/tags/index.html","excerpt":"","text":"[MySQL] [高可用] [压测] [备份恢复][Oracle] [12c]"},{"title":"about","date":"2017-08-12T12:44:16.000Z","updated":"2017-08-12T12:45:41.000Z","comments":true,"path":"about/index.html","permalink":"http://yoursite.com/about/index.html","excerpt":"","text":"About Me一个小小的DBA"}],"posts":[{"title":"ClickHouse安装","slug":"clickhouse-1","date":"2017-08-12T13:06:30.000Z","updated":"2017-08-12T13:10:13.000Z","comments":true,"path":"2017/08/12/clickhouse-1/","link":"","permalink":"http://yoursite.com/2017/08/12/clickhouse-1/","excerpt":"目前ClickHouse对ubuntu系统支持比较友好，对于centos就差一点。Ubuntu有deb包可以直接安装。对于centos的则需要自己编译。","text":"目前ClickHouse对ubuntu系统支持比较友好，对于centos就差一点。Ubuntu有deb包可以直接安装。对于centos的则需要自己编译。 一、安装准备1. 升级gcc编译ClickHouse需要gcc 6.0以上版本，这里安装6.2.0版本。具体步骤记录如下： 1.1 下载 gcc-6.2.0 源码包, 并解压[root@node1 software]# wget http://ftp.gnu.org/gnu/gcc/gcc-6.2.0/gcc-6.2.0.tar.bz2 [root@node1 software]# tar -jvxf gcc-6.2.0.tar.bz2 [root@node1 software]# cd gcc-6.2.0/ [root@node1 contrib]# vim contrib/download_prerequisites 从 contrib/download_prerequisites 文件内查看需要的依赖包 1.2 下载依赖包[root@node1 software]# wget ftp://gcc.gnu.org/pub/gcc/infrastructure/mpfr-2.4.2.tar.bz2 [root@node1 software]# wget ftp://gcc.gnu.org/pub/gcc/infrastructure/gmp-4.3.2.tar.bz2 [root@node1 software]# wget ftp://gcc.gnu.org/pub/gcc/infrastructure/mpc-0.8.1.tar.gz 1.3 安装gmp[root@node1 software]# bzip2 -d gmp-4.3.2.tar.bz2 [root@node1 software]# tar xvf gmp-4.3.2.tar [root@node1 software]# cd gmp-4.3.2/ [root@node1 gmp-4.3.2]# ./configure --prefix=/opt/gcc-6.2.0 [root@node1 gmp-4.3.2]# make &amp;&amp; make install 1.4 安装mpfr[root@node1 gmp-4.3.2]# cd .. [root@node1 software]# bzip2 -d mpfr-2.4.2.tar.bz2 [root@node1 software]# tar xvf mpfr-2.4.2.tar [root@node1 software]# cd mpfr-2.4.2/ [root@node1 mpfr-2.4.2]# ./configure --prefix=/opt/gcc-6.2.0 --with-gmp=/opt/gcc-6.2.0 [root@node1 mpfr-2.4.2]# make -j [root@node1 mpfr-2.4.2]# make install 1.5 安装mpc[root@node1 mpfr-2.4.2]# cd .. [root@node1 software]# tar xvf mpc-0.8.1.tar.gz [root@node1 software]# cd mpc-0.8.1/ [root@node1 mpc-0.8.1]# ./configure --prefix=/opt/gcc-6.2.0 --with-gmp=/opt/gcc-6.2.0 --with-mpfr=/opt/gcc-6.2.0 [root@node1 mpc-0.8.1]# make -j [root@node1 mpc-0.8.1]# make install 1.6 安装gcc[root@node1 mpc-0.8.1]# cd .. [root@node1 software]# cd gcc-6.2.0/ [root@node1 gcc-6.2.0]# mkdir build [root@node1 gcc-6.2.0]# cd build/ [root@node1 build]# ../configure --prefix=/opt/gcc-6.2.0 --with-gmp=/opt/gcc-6.2.0 --with-mpfr=/opt/gcc-6.2.0 --with-mpc=/opt/gcc-6.2.0 -enable-checking=release -enable-languages=c,c++ -disable-multilib [root@node1 build]# make [root@node1 build]# make install 注意：编译过程中可能会出现类似下面的错误： checking for suffix of object files... configure: error: cannot compute suffix of object files: cannot compile See `config.log&apos; for more details. make[2]: *** [configure-stage1-target-libgcc] Error 1 解决方法：将gmp,mpfr,mpc的lib库添加到下面的配置文件中 vi /etc/ld.so.conf include ld.so.conf.d/*.conf /usr/local/lib /opt/gcc-6.2.0/lib #gmp,mpfr,mpc的lib库安装位置 /usr/lib64 添加保存后记得更新动态库的缓存： # ldconfig -v 更新后再去重新编译安装。 1.7 设置环境变量[root@node1 software]# export PATH=/opt/gcc-6.2.0/bin:$PATH [root@node1 software]# export LD_LIBRARY_PATH=/opt/gcc-6.2.0/lib:$LD_LIBRARY_PATH 1.8 查看gcc版本[root@node1 ~]# gcc -v 1.9 创建软链和环境变量[root@node1 ~]# ln -s /usr/local/bin/gcc /usr/local/bin/gcc-6 [root@node1 ~]# ln -s /usr/local/bin/g++ /usr/local/bin/g++-6 [root@node1 ~]# ln -s /usr/local/bin/gcc /usr/local/bin/cc [root@node1 ~]# ln -s /usr/local/bin/g++ /usr/local/bin/c++ [root@node1 ~]# export CC=gcc-6 [root@node1 ~]# export CXX=g++-6 2. 安装其他库依赖包[root@node1 ~]# yum install libicu-devel readline-devel openssl-devel mysql-community-devel unixODBC-devel libtool-ltdl-devel 二、安装ClickHouse1. 下载源码[root@node1 software]# git clone -b stable https://github.com/yandex/ClickHouse.git [root@node1 software]# cd ClickHouse 2. 编译源码mkdir build cd build cmake .. make -j $THREADS make install 注意： 在编译过程中发现对内存的消耗比较大，本人虚机开始配置1G内存，编译时经常莫名的中断报错，后查/var/log/message发现出现OOM情况，后把内存加大到4G，能够正常完成编译 三、简单使用1. 启动clickhouse[root@node1 ~]# /usr/local/bin/clickhouse-server --config-file=/usr/local/etc/clickhouse-server/config.xml &amp; 2. 登录测试[root@node1 ~]# clickhouse-client ClickHouse client version 1.1.54245. Connecting to localhost:9000. Connected to ClickHouse server version 1.1.54245. :) select 1; SELECT 1 ┌─1─┐ │ 1 │ └───┘ 1 rows in set. Elapsed: 0.002 sec. :) select now(); SELECT now() ┌───────────────now()─┐ │ 2017-08-09 23:27:30 │ └─────────────────────┘ 1 rows in set. Elapsed: 0.001 sec. :) 3. 客户端使用3.1 交互模式clickhouse-client clickhouse-client --host=... --port=... --user=... --password=... 3.2 启动多行查询clickhouse-client -m 对于使用多行建表语句进行建表的时候就需要启用多行查询，否则会报错 3.3 以批处理方式运行查询clickhouse-client --query=&apos;SELECT 1&apos; echo &apos;SELECT 1&apos; | clickhouse-client 3.4 从指定格式的文件插入数据clickhouse-client --query=&apos;INSERT INTO table VALUES&apos; &lt; data.txt clickhouse-client --query=&apos;INSERT INTO table FORMAT TabSeparated&apos; &lt; data.tsv 四、参考资料 Column Store Database Benchmarks: MariaDB ColumnStore vs. Clickhouse vs. Apache Spark ClickHouse: New Open Source Columnar Database 彪悍开源的分析数据库-ClickHouse How to build ClickHouse on Linux ClickHouse之初步认识","categories":[],"tags":[]},{"title":"Hello World","slug":"hello-world","date":"2017-08-12T07:41:49.000Z","updated":"2017-08-12T07:41:49.000Z","comments":true,"path":"2017/08/12/hello-world/","link":"","permalink":"http://yoursite.com/2017/08/12/hello-world/","excerpt":"","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new \"My New Post\" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","categories":[],"tags":[]}]}